<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Roommate Chore Tracker</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* --- NEW: Keyframes for flashing animation --- */
        @keyframes flash-red {
            50% {
                background-color: #991b1b; /* red-800 */
                border-color: #7f1d1d; /* red-900 */
            }
        }

        /* Base state for turns */
        .turn-active {
            background-color: #fef08a; /* yellow-200 */
            border-left: 4px solid #eab308; /* yellow-500 */
        }
        .dark .turn-active {
            background-color: #422006; /* yellow-950 */
        }

        /* --- NEW: Warning state (solid red) --- */
        .turn-warning {
            background-color: #fecaca; /* red-200 */
            border-left: 4px solid #ef4444; /* red-500 */
        }
        .dark .turn-warning {
            background-color: #450a0a; /* red-950 */
        }
        
        /* --- NEW: Urgent state (flashing red) --- */
        .turn-urgent {
            border-left: 4px solid #ef4444; /* red-500 */
            animation: flash-red 1s infinite;
        }

        .turn-done {
            background-color: #dcfce7; /* green-200 */
            border-left: 4px solid #22c55e; /* green-500 */
            opacity: 0.7;
        }
        .dark .turn-done {
            background-color: #14532d; /* green-900 */
        }
    </style>
</head>
<body class="bg-gray-100 dark:bg-gray-900 flex items-center justify-center min-h-screen p-4">

    <div class="bg-white dark:bg-gray-800 rounded-2xl shadow-2xl p-8 w-full max-w-md">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800 dark:text-white">Who's Turn Is It?</h1>
            <p class="text-gray-500 dark:text-gray-400 mt-2">Bathroom Cleaning Rotation</p>
        </div>

        <div id="roommate-list" class="space-y-4">
            <div class="roommate flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-xl transition-all duration-300 cursor-pointer" data-index="0">
                <span class="text-lg font-medium text-gray-900 dark:text-white">Alex</span>
            </div>
            <div class="roommate flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-xl transition-all duration-300 cursor-pointer" data-index="1">
                <span class="text-lg font-medium text-gray-900 dark:text-white">Ben</span>
            </div>
            <div class="roommate flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-xl transition-all duration-300 cursor-pointer" data-index="2">
                <span class="text-lg font-medium text-gray-900 dark:text-white">Casey</span>
            </div>
            <div class="roommate flex items-center justify-between p-4 bg-gray-50 dark:bg-gray-700 rounded-xl transition-all duration-300 cursor-pointer" data-index="3">
                <span class="text-lg font-medium text-gray-900 dark:text-white">Dana</span>
            </div>
        </div>

    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (Notification.permission !== 'granted') {
                Notification.requestPermission();
            }

            const roommateElements = document.querySelectorAll('.roommate');
            const roommateNames = Array.from(roommateElements).map(el => el.querySelector('span').textContent);
            let currentTurnIndex = 0;

            // --- NEW: To store the IDs of our scheduled timeouts ---
            let activeTimeouts = [];

            // --- UPDATED: Function to send notifications with custom title/body ---
            function sendNotification(title, body) {
                if (Notification.permission === 'granted') {
                    new Notification(title, { body });
                }
            }

            function updateDisplay() {
                // --- NEW: Clear any previously scheduled notifications before updating ---
                activeTimeouts.forEach(clearTimeout);
                activeTimeouts = [];

                roommateElements.forEach((roommate, index) => {
                    // Clear all previous state classes
                    roommate.classList.remove('turn-active', 'turn-done', 'turn-warning', 'turn-urgent');

                    if (index < currentTurnIndex) {
                        roommate.classList.add('turn-done');
                    } else if (index === currentTurnIndex) {
                        const currentPersonName = roommateNames[currentTurnIndex];
                        
                        // --- STAGE 1: Initial Yellow State ---
                        roommate.classList.add('turn-active');
                        sendNotification("Chore Reminder", `${currentPersonName} is next to clean the bathroom.`);

                        // --- STAGE 2: Schedule the change to Red ---
                        const warningTimeout = setTimeout(() => {
                            roommate.classList.remove('turn-active');
                            roommate.classList.add('turn-warning');
                            sendNotification("Chore Warning!", "You have three days to clean the bathroom.");
                        }, 20000); // 20 seconds

                        // --- STAGE 3: Schedule the change to Flashing Red ---
                        const urgentTimeout = setTimeout(() => {
                            roommate.classList.remove('turn-warning');
                            roommate.classList.add('turn-urgent');
                            // As requested, this is the final notification.
                            sendNotification("URGENT: CHORE OVERDUE", "you fucked up bastard");
                        }, 50000); // 20s + 30s = 50 seconds total

                        // Store the timeout IDs so we can cancel them if needed
                        activeTimeouts.push(warningTimeout, urgentTimeout);
                    }
                });

                // Reset logic
                if (currentTurnIndex >= roommateElements.length) {
                    currentTurnIndex = 0;
                    updateDisplay();
                }
            }

            function advanceTurn() {
                currentTurnIndex++;
                updateDisplay();
            }

            roommateElements.forEach(roommate => {
                roommate.addEventListener('click', () => {
                    const clickedIndex = parseInt(roommate.dataset.index);
                    if (clickedIndex === currentTurnIndex) {
                        advanceTurn();
                    }
                });
            });

            updateDisplay();
        });
    </script>

</body>
</html>
